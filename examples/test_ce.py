import numpy as np
from tinytorch import TensorBase, DeviceType, Tensor
from tinytorch.funcs import softmax_forward, cross_entropy_forward, cross_entropy_backward

from tinytorch.nn import CrossEntropyLoss

x = np.array([
    [1.86472945, 3.62155361, -1.31965916, 4.09653904, 8.84008718, 5.34746362,
     2.3387004, 4.81332744, 2.60539029, 5.32241199],
    [1.86472945, 3.62155361, -1.31965916, 4.09653904, 8.84008718, 5.34746362,
     2.3387004, 4.81332744, 2.60539029, 5.32241199],
    [1.86472945, 3.62155361, -1.31965916, 4.09653904, 8.84008718, 5.34746362,
     2.3387004, 4.81332744, 2.60539029, 5.32241199],
    [1.86472945, 3.62155361, -1.31965916, 4.09653904, 8.84008718, 5.34746362,
     2.3387004, 4.81332744, 2.60539029, 5.32241199],
    [1.86472945, 3.62155361, -1.31965916, 4.09653904, 8.84008718, 5.34746362,
     2.3387004, 4.81332744, 2.60539029, 5.32241199],
    [1.86472945, 3.62155361, -1.31965916, 4.09653904, 8.84008718, 5.34746362,
     2.3387004, 4.81332744, 2.60539029, 5.32241199],
    [1.86472945, 3.62155361, -1.31965916, 4.09653904, 8.84008718, 5.34746362,
     2.3387004, 4.81332744, 2.60539029, 5.32241199],
    [1.86472945, 3.62155361, -1.31965916, 4.09653904, 8.84008718, 5.34746362,
     2.3387004, 4.81332744, 2.60539029, 5.32241199],
    [1.86472945, 3.62155361, -1.31965916, 4.09653904, 8.84008718, 5.34746362,
     2.3387004, 4.81332744, 2.60539029, 5.32241199],
    [1.86472945, 3.62155361, -1.31965916, 4.09653904, 8.84008718, 5.34746362,
     2.3387004, 4.81332744, 2.60539029, 5.32241199]
])
t = np.array([6., 6., 2., 8., 4., 6., 1., 2., 0., 3.])

xt = Tensor.from_numpy(x, DeviceType.GPU)
tt = Tensor.from_numpy(t, DeviceType.GPU)

criterion = CrossEntropyLoss()
loss = criterion(xt, tt)

print(loss.to_numpy())